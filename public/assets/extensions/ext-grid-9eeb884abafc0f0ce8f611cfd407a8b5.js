/*
 * ext-grid.js
 *
 * Licensed under the Apache License, Version 2
 *
 * Copyright(c) 2010 Redou Mine
 * Copyright(c) 2010 Alexis Deveria
 *
 */
svgEditor.addExtension("view_grid",function(t){function e(t){+l.attr("width"),+l.attr("height");var e=svgedit.units.getTypeMap(),i=e[svgEditor.curConfig.baseUnit],n=[.01,.1,1,10,100,1e3],a=0,s=0===a,o=s?"x":"y",c=svgCanvas.getContentElem();c.getAttribute(o)-0;for(var h=r,d=i*t,p=100/d,f=1,g=0;g<n.length;g++){var m=n[g];if(f=m,m>=p)break}var v=f*d;h.width=v,h.height=v;var y=h.getContext("2d"),b=.5,x=v/10;y.globalAlpha=.2,y.strokeStyle="#000";for(var g=1;10>g;g++){var w=Math.round(x*g)+.5,_=0;y.moveTo(w,v),y.lineTo(w,_),y.moveTo(v,w),y.lineTo(_,w)}y.stroke(),y.beginPath(),y.globalAlpha=.5,y.moveTo(b,v),y.lineTo(b,0),y.moveTo(v,b),y.lineTo(0,b),y.stroke();var k=h.toDataURL("image/png");u.setAttribute("width",v),u.setAttribute("height",v),u.parentNode.setAttribute("width",v),u.parentNode.setAttribute("height",v),svgCanvas.setHref(u,k)}var i=document.getElementById("svgcanvas").ownerDocument,n="http://www.w3.org/2000/svg";svgEditor.curConfig.dimensions,t.svgroot;var a=!1,s=svgCanvas.assignAttributes,r=document.createElement("canvas");$(r).hide().appendTo("body");var o=i.createElementNS(n,"svg");s(o,{id:"canvasGrid",width:"100%",height:"100%",x:0,y:0,overflow:"visible",display:"none"});var l=$("#canvasBackground");l.append(o);var c=i.createElementNS(n,"pattern");s(c,{id:"gridpattern",patternUnits:"userSpaceOnUse",x:0,y:0,width:100,height:100});var u=i.createElementNS(n,"image");s(u,{x:0,y:0,width:100,height:100}),c.appendChild(u),$("#canvasGrid").append(c);var h=i.createElementNS(n,"rect");return s(h,{width:"100%",height:"100%",x:0,y:0,"stroke-width":0,stroke:"none",fill:"url(#gridpattern)",style:"pointer-events: none; display:visible;"}),$("#canvasGrid").append(h),{name:"view_grid",svgicons:"/assets/extensions/grid-icon.xml",zoomChanged:function(t){a&&e(t)},buttons:[{id:"view_grid",type:"context",panel:"editor_panel",title:"Show/Hide Grid",events:{click:function(){var t=!$("#view_grid").hasClass("push_button_pressed");t?(svgEditor.curConfig.showGrid=a=!0,$("#view_grid").addClass("push_button_pressed").removeClass("tool_button"),$("#canvasGrid").attr("display","normal"),e(svgCanvas.getZoom())):(svgEditor.curConfig.showGrid=a=!1,$("#view_grid").removeClass("push_button_pressed").addClass("tool_button"),$("#canvasGrid").attr("display","none"))}}}]}});